---
title: 基于视频的车牌识别和流量统计
toc: true

tags:
  - 车牌识别
date: 2017-03-08 16:12:08
---

基于视频的车牌识别和流量统计

<!-- more -->

## 车流量统计功能

1. 读取视频数据
2. 针对读入的每帧图像，转换成灰度图像；`cvCvtColor(frame, pFrImg, CV_BGR2GRAY);  `
3. 做高斯滤波，平滑图像；`cvSmooth(pFrameMat, pFrameMat, CV_GAUSSIAN, 3, 0, 0);  `
4. 背景差分，当前图像和北京图像做差；`cvAbsDiff(pFrameMat, pBkMat, pFrMat);  `
5. 二值化前景图，（前面的是灰度图像，现在是二值图像，只有黑白两色，背景是黑色，运动物体是白色）
6. 更新背景;`cvRunningAvg(pFrameMat, pBkMat, 0.1, 0); `

上面的步骤完成运动物体的检测，现在视频流被处理成黑白两色，运动的车辆是白色，背景是黑色。下面使用撞线检测的方法检测是否有车辆通过。

1. 统计一个固定区域的像素平均值，当有车辆经过时，这个地方的像素均值急剧增大，当它过去的时候，像素均值急剧减少，通过捕捉这个变化，确定是否有车通过。
2. 针对连续通过的车辆，从时间和中间的变化来判断
3. 针对多个车道，初始的时候有一个检测车道的方法，把车道的数据存储起来，分别对每个车道统计； 针对跨越车道的车辆，就是一半在这个车道，一半在另外一个车道的， 采用两个车道合并的数据，看统一时间相邻的车道是否有宽度合并起来约为一辆车的，计算为一辆车。
4. 每当检测出有车辆经过的时候，捕捉这辆车的车牌位置的彩色高清截图，保存下来。

## 车牌识别功能

1. 输入是上面保存的图片
2. 在HSV空间判断像素的颜色，提取颜色特征
3. 提取图像的纹理特征。
4. 在颜色特征和纹理特征的基础上，粗定位车牌的位置
5. 精细搜索，定位车牌的位置，保存车牌图片，用于后面的识别。

上面的步骤完成车牌的定位，此时每辆车的车牌图像已经被保存下来了，下面是最关键的文字识别。识别采用的是模版匹配的方法，即我们预先有所有字母和数字和所有省份缩写的模版。

1. 分割图像（依据连通域和字符的宽度和高度）
2. 针对分割出来的每个字符(汉字，数字，字母)， 计算和模版图片的相似度，取相似度最高的作为输出
3. 对ODQ，2Z，5S，8B，等相似字符进行二次检测
4. 


## HSV二值化：

HSV颜色空间：比较适合用来分割不同的颜色。
车牌一般为黄色和蓝色，我们使用HSV颜色空间来寻找车牌的位置

## 纹理二值化


## 模版匹配：

模版匹配是寻找目标图像的方法之一，它通过在输入图像上滑动图像块对实际的图像块和输入图像进行匹配。
我们使用预定义的字母模版匹配车牌上分割下来的字母和数字，以识别牌照上的字母和数字。

## 背景差分

根据前N帧图像的灰度值进行区间统计从而得到一个具有统计意义的初始背景。
当前的最新图像与背景做差，即可求得背景差图，然后根据一定的方法对图进行二值化，就能获得运动物体。
图像二值化的一个关键是阈值的选取，目前采用的方法有最大类间方差法，一维交叉熵阈值法，二维交叉熵阈值法。
背景的更新使用的是OPENCV实现的一个滑动平均的方法

```c
cvRunningAvg( const CvArr* image, CvArr* acc, double alpha, const CvArr* mask=NULL );
```

可以通过设置alpha的值来更新背景，alpha越大，背景更新的越快。